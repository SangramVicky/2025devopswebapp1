pipeline{
    agent any
    environment{
        PATH = "${PATH}:${tool name: 'maven3.x', type: 'maven'}/bin"
     }
    stages{
        stage('Git'){
            steps{
                git credentialsId: 'GIT', url: 'https://github.com/SangramVicky/2025devopswebapp1', branch:'master'
            }
         }
         stage('maven') {
            steps{
                sh "mvn clean package"
            }
        }
        stage('Deploy') {
            steps{
                sshagent(['Tom']) {
                  //Shutdown tomcat server
                     sh "ssh -o StrictHostKeyChecking=no ec2-user@172.31.32.5 /opt/tomcat/bin/shutdown.sh"
    
                  //copy war file to remote tomact server
                     sh "scp target/2025devopswebapp1.war ec2-user@172.31.32.5:/opt/tomcat/webapps/"
    
                  //start tomcat server
                     sh "ssh ec2-user@172.31.32.5 /opt/tomcat/bin/startup.sh"
                }
            }
        }
    }
	post {
  failure {
   mail body: """hi its from jenkins
 your deployment Failed.
   ${BUILD_URL}

 team-Devops
 status - Not ok""", subject: "${JOB_NAME} deployment failed", to: 'ashutoshpattanaik78@gmail.com'
      }
  success {
    mail body: """hi its from jenkins
 your deployment successful.
  ${BUILD_URL}
 team-Devops
 status - ok""", subject: "${JOB_NAME} - Deployed Suceessfully!!!", to: 'ashutoshpattanaik78@gmail.com'
     }
   }	
}
